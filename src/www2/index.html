<!DOCTYPE html>
<html>
<head>
	<title>Retro Webserv</title>
	<link rel="icon" type="image/x-icon" href="/favicon.ico">
	<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Press Start 2P', cursive;
			color: #00ffcc;
			background: linear-gradient(#1a1a1a, #0f0f0f);
			background-attachment: fixed;
			background-size: cover;
			overflow-x: hidden;
			position: relative;
		}

		body::before, body::after {
			content: "";
			position: fixed;
			width: 100%;
			height: 200%;
			top: 0;
			left: 0;
			z-index: -2;
			transform: translateZ(-1px) scale(2);
			background: linear-gradient(180deg, #ff007f, #1a1a1a, #007fff);
			background-attachment: fixed;
			animation: bgAnim 10s ease-in-out infinite alternate;
		}

		@keyframes bgAnim {
			from { filter: hue-rotate(0deg); }
			to { filter: hue-rotate(360deg); }
		}

		h1, h2 {
			text-align: center;
			text-shadow: 2px 2px 0 #ff00ff, -2px -2px 0 #00ffff;
			margin: 30px 0;
		}

		p {
			text-align: center;
			margin-bottom: 30px;
		}

		input, button {
			display: block;
			margin: 15px auto;
			padding: 10px 20px;
			border: 2px solid #00ffcc;
			background-color: #000;
			color: #00ffcc;
			cursor: pointer;
			transition: all 0.3s ease-in-out;
			text-transform: uppercase;
			font-family: 'Press Start 2P', cursive;
			box-shadow: 0 0 10px #00ffcc55;
		}

		input[type="file"] {
			color: #00ffcc;
			background-color: #111;
		}

		input::placeholder {
			color: #00ffccaa;
		}

		button:hover {
			background: #00ffcc;
			color: #000;
			box-shadow: 0 0 20px #00ffcc, 0 0 30px #00ffcc;
			transform: scale(1.08) rotate(-1deg);
		}

		br {
			line-height: 2em;
		}

		audio {
			display: none;
		}
	</style>
</head>
<body>

<audio autoplay loop muted id="bgMusic">
	<source src="ai_gen_8_bit.mp3" type="audio/mp3">
	Your browser does not support the audio element.
</audio>

<h1>üöÄ Retro Webserv Arcade üöÄ</h1>
<p>Upload. Delete. Play. Hack the Web.</p>

<input type="file" id="myFile">
<button onclick="uploadFile()">Upload File</button>

<br><br>

<input type="file" id="fileToDelete">
<button onclick="deleteFile()">Delete Selected File</button>

<br><br>

<h2>üíæ CGI Playground</h2>

<button onclick="tryCGI('../cgi/hello.py')">üéÆ Try Working CGI</button><br>
<button onclick="tryCGI('../cgi/loop.py')">‚ôæÔ∏è Endless CGI</button><br>
<button onclick="tryCGI('../cgi/hell.py')">‚ùå Non-existing CGI</button><br>
<button onclick="tryCGI('../cgi/mistake.py')">‚ö†Ô∏è Wrong CGI</button><br><br>

<input type="text" id="nameOfUser" placeholder="Enter your name">
<button onclick="tryCGIpost('../cgi/for_post.py')">üì® Try POST CGI</button><br><br>

<script>
	function uploadFile() {
		const fileInput = document.getElementById("myFile");
		const file = fileInput.files[0];
		if (!file) {
			alert("Please select a file");
			return;
		}
		const filename = file.name;
		fetch('/uploads', {
			method: "POST",
			headers: {
				"Content-Type": "application/octet-stream",
				"Content-Disposition": 'attachment; filename="' + filename + '"',
			},
			body: file
		})
		.then(response => console.log("Upload complete"))
		.catch(error => console.error("Error:", error));
	}
</script>

<script>
	function deleteFile() {
		const fileInput = document.getElementById("fileToDelete");
		const file = fileInput.files[0];
		if (!file) {
			alert("Please select a file to delete.");
			return;
		}
		const filename = file.name;
		fetch('/uploads/' + encodeURIComponent(filename), {
			method: "DELETE"
		})
		.then(response => {
			if (response.ok) {
				console.log("Deleted: " + filename);
			} else {
				console.error("Failed to delete: " + filename);
			}
		})
		.catch(error => console.error("Error:", error));
	}
</script>

<script>
	function tryCGI(location) {
		fetch(location)
			.then(response => response.text())
			.then(data => {
				history.pushState(data, '', location);
				document.open();
				document.write(data);
				document.close();
				window.addEventListener('popstate', () => {
					window.location.href = '/index.html';
				});
			})
			.catch(error => console.error("Error:", error));
	}
</script>

<script>
	function tryCGIpost(location) {
		const name = document.getElementById("nameOfUser").value;
		const data = `name=${encodeURIComponent(name)}`;
		fetch(location, {
			method: "POST",
			headers: {
				"Content-Type": "application/x-www-form-urlencoded"
			},
			body: data
		})
		.then(response => response.text())
		.then(data => {
			history.pushState(null, '', location);
			document.open();
			document.write(data);
			document.close();
			window.addEventListener('popstate', () => {
				window.location.href = '/index.html';
			});
		})
		.catch(error => console.error("Error:", error));
	}
</script>

</body>
</html>
