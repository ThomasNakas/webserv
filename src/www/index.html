<!DOCTYPE html>
<html>
<head>
	<title>Webserv</title>
	<link rel="icon" type="image/x-icon" href="/favicon.ico">
	<style>
		/* Retro Arcade Font */
		@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

		html, body {
			margin: 0;
			padding: 0;
			font-family: 'Press Start 2P', cursive;
			color: #00ffcc;
			background: linear-gradient(#1a1a1a, #0f0f0f);
			background-attachment: fixed;
			background-size: cover;
			overflow-x: hidden;
		}

		body::before {
			content: "";
			position: fixed;
			top: 0;
			left: 0;
			height: 200%;
			width: 100%;
			background: linear-gradient(180deg, #2b1055, #7597de, #2b1055);
			z-index: -1;
			transform: translateZ(-1px) scale(2);
			background-attachment: fixed;
		}

		h1, h2 {
			text-align: center;
			text-shadow: 2px 2px 0 #ff00ff, -2px -2px 0 #00ffff;
		}

		p {
			text-align: center;
			margin-bottom: 30px;
		}

		input, button {
			display: block;
			margin: 10px auto;
			padding: 10px 20px;
			font-family: 'Press Start 2P', cursive;
			border: 2px solid #00ffcc;
			background-color: #000;
			color: #00ffcc;
			cursor: pointer;
			transition: all 0.2s ease-in-out;
			text-transform: uppercase;
		}

		input::placeholder {
			color: #00ffccaa;
		}

		button:hover {
			background: #00ffcc;
			color: #000;
			box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
			transform: scale(1.05);
		}

		input[type="file"] {
			color: #00ffcc;
			cursor: pointer;
			background-color: #111;
		}

		br {
			line-height: 2em;
		}
	</style>
</head>
<body>

	<h1>The simplest index ever</h1>
	<p>Is this a simple index or what?</p>
	
	<input type="file" id="myFile">
	<button onclick="uploadFile()">Upload</button>
	
	<br><br>
	
	<input type="text" id="filenameToDelete" placeholder="Enter filename to delete">
	<button onclick="deleteFile()">Delete</button>
	
	<br><br>
	
	<h2>CGI</h2>
	
	<button onclick="tryCGI('../cgi/hello.py')">Try working CGI</button><br><br>
	<button onclick="tryCGI('../cgi/loop.py')">Try endless CGI</button><br><br>
	<button onclick="tryCGI('../cgi/hell.py')">Try non-existing CGI</button><br><br>
	<button onclick="tryCGI('../cgi/mistake.py')">Try wrong CGI</button><br><br>
	<input type="text" id="nameOfUser" placeholder="Enter your name">
	<button onclick="tryCGIpost('../cgi/for_post.py')">Try post CGI</button><br><br>
	
	<script>
		function uploadFile() {
			const fileInput = document.getElementById("myFile");
			const file = fileInput.files[0];
	
			if (!file) {
				alert("Please select a file");
				return;
			}
	
			const filename = file.name;
	
			fetch('/uploads', {
				method: "POST",
				headers: {
					"Content-Type": "application/octet-stream",
					"Content-Disposition": 'attachment; filename="' + filename + '"',
				},
				body: file // Send the raw file
			}).then(response => console.log("Upload complete"))
			  .catch(error => console.error("Error:", error));
		}
	</script>
	
	<script>
		function deleteFile() {
			const filenameInput = document.getElementById("filenameToDelete");
			
			if (!filenameInput || !filenameInput.value) {
				alert("Please enter a filename to delete.");
				return;
			}
	
			const filename = filenameInput.value;
	
			fetch(encodeURIComponent(filename), {
				method: "DELETE"
			})
			.then(response => {
				if(response.ok) {
					console.log ("Deleted: " + filename);
				} else {
					console.error("Failed to delete: " + filename);
				}
			})
			.catch(error => console.error("Error: ", error));
		}
	</script>
	
	<script>
		function tryCGI(location) {
		fetch(location)
			.then(response => response.text())
			.then(data => {
				history.pushState(data, '', location);
				document.open();
				document.write(data);
				document.close();
				window.addEventListener('popstate', () => {
					window.location.href = '/index.html';
				});
			})
			.catch(error => {
				console.error("Error:", error);
			});
		}
	</script>
	
	<script>
		function tryCGIpost(location) {
			const name = document.getElementById("nameOfUser").value;
			const data = `name=${encodeURIComponent(name)}`;
	
		fetch(location, {
			method: "POST",
			headers: {
				"Content-Type": "application/x-www-form-urlencoded"
			},
			body: data
		})
			.then(response => response.text())
			.then(data => {
				history.pushState(null, '', location);
				document.open();
				document.write(data);
				document.close();
				window.addEventListener('popstate', () => {
					window.location.href = '/index.html';
				});
			})
			.catch(error => {
			  console.error("Error:", error);
			});
		}
	</script>
	
	</body>
</html>
